OBJDIRS += lib lib/$(ARCH)

LIB_SRCFILES :=	\
	lib/$(ARCH)/strlen.S \
	lib/$(ARCH)/longjmp.S \
	lib/$(ARCH)/syscall_entry.S \
	lib/$(ARCH)/gate_entry.c \
	lib/memcpy.c \
	lib/memset.c \
	lib/syscall.c \
	lib/printfmt.c \
	lib/printf.c \
	lib/string.c \
	lib/libmain.c \
	lib/panic.c \
	lib/console.c \
	lib/readline.c \
	lib/segment.c \
	lib/elf.c \
	lib/thread.c \
	lib/gate.c \
	lib/netd_client.c \
	lib/netd_server.c \
	lib/fd.c

include lib/$(ARCH)/Makefrag
include lib/lwip/Makefrag
#include lib/sqlite/Makefrag
#include lib/pcre/Makefrag

LIB_OBJFILES := $(patsubst lib/%.c, $(OBJDIR)/lib/%.o, $(LIB_SRCFILES))
LIB_OBJFILES := $(patsubst lib/$(ARCH)/%.S, $(OBJDIR)/lib/%.o, $(LIB_OBJFILES))

$(OBJDIR)/lib/%.o: lib/%.c
	@mkdir -p $(@D)
	$(CC) -nostdinc $(USER_CFLAGS) $(CSTD) -c -o $@ $<

$(OBJDIR)/lib/%.o: lib/$(ARCH)/%.c
	@mkdir -p $(@D)
	$(CC) -nostdinc $(USER_CFLAGS) $(CSTD) -c -o $@ $<

$(OBJDIR)/lib/%.o: lib/$(ARCH)/%.S
	@mkdir -p $(@D)
	$(CC) -nostdinc $(USER_CFLAGS) -c -o $@ $<

$(OBJDIR)/lib/libjos.a: $(LIB_OBJFILES)
	rm -f $@
	$(AR) r $@ $(LIB_OBJFILES)
